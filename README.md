# HighLoad

## Тема работы

Spotify

## Основной функционал

- хранение и воспроизведение аудио файлов
- рекомендательная система по подбору музыкальных произведений, обучающаяся на основе пропуска треков
- хранение информации о музыкальных произведениях (текст, исполнители, альбомы)
- хранение общих плейлистов
- возможность составлять собстевнные плейлисты пользователями

## Целевая аудитория

Во втором квартале 2022 года сервис потоковой передачи музыки Spotify сообщил о 433 миллионах активных пользователей по всему миру. Это ознаменовало увеличение более чем на 60 миллионов всего за один год[1]:

![graps](./images/mau.png)

Во втором квартале 2022 года количество ежемесячно активных пользователей Spotify по всему миру, поддерживаемых рекламой, достигло 256 миллионов по сравнению с 210 миллионами годом ранее.[2] 

По состоянию на второй квартал 2022 года у Spotify было 188 миллионов платных подписчиков по всему миру по сравнению со 165 миллионами в соответствующем квартале 2021 года.[3]

Ежедневно 44% пользователей слушают Spotify[4]

В целом Spotify наиболее популярен среди молодежи. Более половины пользователей Spotify моложе 35 лет[5]:

![graps](./images/Spotify-user-demographics.png)

- 29% пользователей Spotify — миллениалы, а 26% из них моложе 24 лет. 
- Spotify также популярен среди пожилых людей: 19% пользователей старше 55 лет.
- Что касается пола, 56% пользователей Spotify — мужчины, а 44% — женщины.

Ежегодное количество пользователей Spotify по регионам с 2016 по 2021 год[6]:

 Год  | Европа  | Северная Америка  | Латинская Америка  | Остальной мир  |
------| --------| ------------------| -------------------| ---------------|
 2016 |  40 млн.|       36 млн.     |       20 млн.      |     8 млн.     |
 2017 |  51 млн.|       46 млн.     |       28 млн.      |     13 млн.    |
 2018 |  67 млн.|       56 млн.     |       38 млн.      |     20 млн.    |
 2019 |  84 млн.|       65 млн.     |       49 млн.      |     35 млн.    |
 2020 | 102 млн.|       78 млн.     |       66 млн.      |     54 млн.    |
 2021 | 121 млн.|       85 млн.     |       78 млн.      |     71 млн.    |

## Расчет нагрузки

* Месячная аудитория: 433 млн.
* Дневная аудитория: 44% от месячной аудитории - 190 млн.

### Хранение данных

Битрейт песни зависит от подписки и от качества соединения[7].
Для бесплатной версии высокое качество - 160 кбит/с, нормальное - 96 кбит/с, низкое - 24 кбит/с
Для платной версии высокое качество - 320 кбит/с, нормальное - 96 кбит/с, низкое - 24 кбит/с

Длительность одной композиции составляет в среднем 197 секунд[8].

Количество песен в Spotify - 80 млн.[9]

В расчетах не будем учитывать хранение информацию об альбомах и плйлистах

Размер 1 песни для каждого битрейта:
- 197 * 24 = 591 Кбайт = 0,58 Мбайт 
- 197 * 96 = 2,3 Мбайт 
- 197 * 160 = 3,8 Мбайт 
- 197 * 320 = 7,7 Мбайт

Размер хранилища для аудиофайлов:
80 * 10^6 * (0,58 + 2,3 + 3,8 + 7,7) = 1097 ТБ

Пусть средний размер текста песни - 3000 символов(UTF-8) = 3000 байт
Тогда размер хранилища для текстов песен: 3000 * 80 * 10^6 / 1024 / 1024 / 1024 = 224 Гбайт

Пусть фото обложки песен хранится в двух форматах:
- 180 х 180, webp = 15 Кбайт
- 3000 х 3000, webp = 600 Кбайт
Тогда размер хранилища для обложек песен: (15 + 600) * 80 * 10^6 / 1024 / 1024 / 1024 = 46 Тбайт

### Сетевой трафик

Согласно последним доступным данным, среднее количество времени, которое активные пользователи платформы тратят на прослушивание Spotify, составляет 25 часов в месяц.[10]

То есть примерно 50 минут в день

188 млн. платных подписчиков из 433 млн. пользователей - 43%

DAU 190 млн. 

Дневной трафик:

`190 * 10^6 * 50 * 60 * (0,43 * 320 + 0,57 * 160)/8/1024/1024/1024 = 15182 Тб/сутки`

Трафик в секунду:

`15182 / 24 / 3600 * 8 = 1,4 Тбит/с`

Исходя из данных 2018 года[11], пиковое время - 16:00. Допустим, в это время Spotify посещают 50% дневной аудитории. А если учесть тот факт, что в это время может выпустить песню популярный артист, то это число может вырости до 70%:

`190 * 10^6 * 0,7 * (0,43 * 320 + 0,57 * 160)/8/1024/1024/1024 = 3,5 Тб/с`

### RPS

#### Авторизация

Пусть запрос на авторизацию совершается раз в 3 месяца

`433 * 10^6 / 3 / 30 / 24 / 60 / 60 = 56 RPS`

#### Получение информации о своем плейлисте

Пусть человек заходит в свою медиатеку 2 раза в день

`190 * 10^6 * 2 / 24 / 60 / 60 = 4398 RPS`

#### Получение информации об конкретном альбоме, плейлисте

Пусть человек прослушивает 4 плейлиста в день:

`190 * 10^6 * 4 / 24 / 60 / 60 = 8796 RPS`

#### Загрузка аудиофайла

Средняя продолжительность одной песни - 197 секунд

Среднее время прослушивания песен в Spotify - 50 минут


`50 * 60 / 197 = 15` треков в среднем пользователь слушает в день

`190 * 10^6 * 15 / 24 / 60 / 60 = 32986 RPS`

#### Загрузка информации о треке

Загружается трек и информация о нем - 2 запроса

Из предыдущего пункта мы знаем, что пользователь в среднем слушает 15 треков в день

`190 * 10^6  * 15 / 24 / 60 / 60 = 32986 RPS`

#### Поиск

Пусть человек пользуется поиском 3 раза в день

`190 * 10^6 * 3 / 24 / 60 / 60 = 6597 RPS`

#### Итог

Всего RPS = 85819 RPS

| Авторизация | Cвой плейлист | Контент альбомов/плейлистов | Поиск     | Загрузка аудиофайла    |Загрузка информации о треке |
|-------------|-----------|-----------------------------|-----------|-------------|-------------|
| 56 RPS    | 4398 RPS | 8796 RPS                   | 6597 RPS | 32986 RPS |32986 RPS    |
| 0,07%        | 5,12%      | 10,25%                        | 7,69%      | 38,44%         |38,44%        |

## Источники
    1. https://www.statista.com/statistics/367739/spotify-global-mau/
    2. https://www.statista.com/statistics/813787/spotify-ad-supported-monthly-active-users/
    3. https://www.statista.com/statistics/244995/number-of-paying-spotify-subscribers/
    4. https://www.businessofapps.com/data/spotify-statistics/
    5. https://siteefy.com/spotify-statistics/
    6. https://www.businessofapps.com/data/spotify-statistics/
    7. https://support.spotify.com/us/article/audio-quality/
    8. https://www.statista.com/chart/26546/mean-song-duration-of-currently-streamable-songs-by-year-of-release/#:~:text=The%20average%20song%20released%20on,song%20lengths%20starting%20in%201990.
    9. https://newsroom.spotify.com/company-info/#:~:text=Discover%2C%20manage%20and%20share%20over,ad%2Dfree%20music%20listening%20experience.
    10. https://kommandotech.com/statistics/spotify-user-statistics/
    11. https://www.businessofbusiness.com/articles/hours-of-the-day-when-people-listen-to-spotify-the-most/
 
